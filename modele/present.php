<?php
$presences1 = array(
    array(
        "prenom" => "Aminata",
        "nom" => "Diop",
        "date_naissance" => "1998-05-15",
        "lieu_naissance" => "Dakar",
        "mail" => "aminata.diop@example.com",
        "numero" => "771234567",
        "referentiel" => "devweb",
        "matricule" => "P6_DEVWEB_2024_1",
        "statut" => "present",
        "sex" => "M",
        "heure_arrivee" => "08:10",
        "retard" => 5,
        "jour" => "2024-04-09",
        "promo" => "P6",
    ),
    array(
        "prenom" => "mada",
        "nom" => "fa",
        "date_naissance" => "1998-05-15",
        "lieu_naissance" => "Dakar",
        "mail" => "aminata.diop@example.com",
        "numero" => "771234567",
        "referentiel" => "devweb",
        "matricule" => "P6_DEVWEB_2024_1",
        "statut" => "present",
        "sex" => "M",
        "heure_arrivee" => "08:10",
        "retard" => 5,
        "jour" => "2024-04-09",
        "promo" => "P6",
    ),array(
        "prenom" => "la",
        "nom" => "dd",
        "date_naissance" => "1998-05-15",
        "lieu_naissance" => "Dakar",
        "mail" => "aminata.diop@example.com",
        "numero" => "771234567",
        "referentiel" => "devweb",
        "matricule" => "P6_DEVWEB_2024_1",
        "statut" => "present",
        "sex" => "M",
        "heure_arrivee" => "08:10",
        "retard" => 5,
        "jour" => "2024-04-09",
        "promo" => "P",
    ),array(
        "prenom" => "dia",
        "nom" => "dia",
        "date_naissance" => "1998-05-15",
        "lieu_naissance" => "Dakar",
        "mail" => "aminata.diop@example.com",
        "numero" => "771234567",
        "referentiel" => "devweb",
        "matricule" => "P6_DEVWEB_2024_1",
        "statut" => "present",
        "sex" => "M",
        "heure_arrivee" => "08:10",
        "retard" => 5,
        "jour" => "2024-04-09",
        "promo" => "P4",
    ),array(
        "prenom" => "dd",
        "nom" => "dd",
        "date_naissance" => "1998-05-15",
        "lieu_naissance" => "Dakar",
        "mail" => "aminata.diop@example.com",
        "numero" => "771234567",
        "referentiel" => "devweb",
        "matricule" => "P6_DEVWEB_2024_1",
        "statut" => "present",
        "sex" => "M",
        "heure_arrivee" => "08:10",
        "retard" => 5,
        "jour" => "2024-04-09",
        "promo" => "P6",
    ),array(
        "prenom" => "Aminata",
        "nom" => "Diop",
        "date_naissance" => "1998-05-15",
        "lieu_naissance" => "Dakar",
        "mail" => "aminata.diop@example.com",
        "numero" => "771234567",
        "referentiel" => "devweb",
        "matricule" => "P6_DEVWEB_2024_1",
        "statut" => "present",
        "sex" => "M",
        "heure_arrivee" => "08:10",
        "retard" => 5,
        "jour" => "2024-04-09",
        "promo" => "P4",
    ),array(
        "prenom" => "Aminata",
        "nom" => "Diop",
        "date_naissance" => "1998-05-15",
        "lieu_naissance" => "Dakar",
        "mail" => "aminata.diop@example.com",
        "numero" => "771234567",
        "referentiel" => "devweb",
        "matricule" => "P6_DEVWEB_2024_1",
        "statut" => "present",
        "sex" => "M",
        "heure_arrivee" => "08:10",
        "retard" => 5,
        "jour" => "2024-04-09",
        "promo" => "P6",
    ),array(
        "prenom" => "Aminata",
        "nom" => "Diop",
        "date_naissance" => "1998-05-15",
        "lieu_naissance" => "Dakar",
        "mail" => "aminata.diop@example.com",
        "numero" => "771234567",
        "referentiel" => "devweb",
        "matricule" => "P6_DEVWEB_2024_1",
        "statut" => "present",
        "sex" => "M",
        "heure_arrivee" => "08:10",
        "retard" => 5,
        "jour" => "2024-04-09",
        "promo" => "P6",
    ),array(
        "prenom" => "Aminata",
        "nom" => "Diop",
        "date_naissance" => "1998-05-15",
        "lieu_naissance" => "Dakar",
        "mail" => "aminata.diop@example.com",
        "numero" => "771234567",
        "referentiel" => "devweb",
        "matricule" => "P6_DEVWEB_2024_1",
        "statut" => "present",
        "sex" => "M",
        "heure_arrivee" => "08:10",
        "retard" => 5,
        "jour" => "2024-04-09",
        "promo" => "P6",
        
    ),array(
        "prenom" => "Aminata",
        "nom" => "Diop",
        "date_naissance" => "1998-05-15",
        "lieu_naissance" => "Dakar",
        "mail" => "aminata.diop@example.com",
        "numero" => "771234567",
        "referentiel" => "devweb",
        "matricule" => "P6_DEVWEB_2024_1",
        "statut" => "present",
        "sex" => "M",
        "heure_arrivee" => "08:10",
        "retard" => 5,
        "jour" => "2024-04-09",
        "promo" => "P5",
    ),array(
        "prenom" => "Aminata",
        "nom" => "Diop",
        "date_naissance" => "1998-05-15",
        "lieu_naissance" => "Dakar",
        "mail" => "aminata.diop@example.com",
        "numero" => "771234567",
        "referentiel" => "devweb",
        "matricule" => "P6_DEVWEB_2024_1",
        "statut" => "present",
        "sex" => "M",
        "heure_arrivee" => "08:10",
        "retard" => 5,
        "jour" => "2024-04-09",
        "promo" => "P6",
    ),array(
        "prenom" => "Aminata",
        "nom" => "Diop",
        "date_naissance" => "1998-05-15",
        "lieu_naissance" => "Dakar",
        "mail" => "aminata.diop@example.com",
        "numero" => "771234567",
        "referentiel" => "devweb",
        "matricule" => "P6_DEVWEB_2024_1",
        "statut" => "present",
        "sex" => "M",
        "heure_arrivee" => "08:10",
        "retard" => 5,
        "jour" => "2024-04-09",
        "promo" => "P6",
    ),array(
        "prenom" => "Aminata",
        "nom" => "Diop",
        "date_naissance" => "1998-05-15",
        "lieu_naissance" => "Dakar",
        "mail" => "aminata.diop@example.com",
        "numero" => "771234567",
        "referentiel" => "devweb",
        "matricule" => "P6_DEVWEB_2024_1",
        "statut" => "absent",
        "sex" => "M",
        "heure_arrivee" => "08:10",
        "retard" => 5,
        "jour" => "2024-04-09",
        "promo" => "P3",
    ),array(
        "prenom" => "Aminata",
        "nom" => "Diop",
        "date_naissance" => "1998-05-15",
        "lieu_naissance" => "Dakar",
        "mail" => "aminata.diop@example.com",
        "numero" => "771234567",
        "referentiel" => "devweb",
        "matricule" => "P6_DEVWEB_2024_1",
        "statut" => "present",
        "sex" => "M",
        "heure_arrivee" => "08:10",
        "retard" => 5,
        "jour" => "2024-04-09",
        "promo" => "P1",
    ),array(
        "prenom" => "Aminata",
        "nom" => "Diop",
        "date_naissance" => "1998-05-15",
        "lieu_naissance" => "Dakar",
        "mail" => "aminata.diop@example.com",
        "numero" => "771234567",
        "referentiel" => "devweb",
        "matricule" => "P6_DEVWEB_2024_1",
        "statut" => "present",
        "sex" => "M",
        "heure_arrivee" => "08:10",
        "retard" => 5,
        "jour" => "2024-04-09",
        "promo" => "P1",
    ),
);

    // writeCsv(FILE.$page,".csv",$presences1);
    $presences=readCsv(FILE.$page,".csv");
    $presences=filterByprom($presences,$namePactive);
    $eleByPage=10;
    $pageEtu = $_GET['pageAff'] ?? 1;
    
    if(isset($_POST["statut"])||isset($_POST["search"]))
    $_SESSION['affichePresence'] = $_REQUEST;

    if($_SESSION["user"]["role"]=="etudiant" && !isset($_POST["jour"]))
   { $_SESSION["affichePresence"]["jour"] = "";
    $_SESSION["affichePresence"]["statut"] = "";
}
    if($_SESSION["user"]["role"]=="admin" && !isset($_POST["jour"]))
   { $_SESSION["affichePresence"]["jour"] = date("Y-m-d");
    $_SESSION["affichePresence"]["statut"] = "";
    $_SESSION["affichePresence"]["referentiel"] = "";
    
}


function filtrerPresences($presences) {
    
    $sess=$_SESSION["affichePresence"];
    $statut_filtre = $sess['statut'];
    $referentiel_filtre = $sess['referentiel'] ;
    $search=$sess["search"];
    $date_filtre = $sess['jour'];
    return ($statut_filtre == "" || $presences["statut"] == $statut_filtre) &&
    ($referentiel_filtre == "" ||  $presences["referentiel"] == $referentiel_filtre) &&
    ($date_filtre == "" || $presences["jour"] == $date_filtre)&&
    ($search == "" || stristr($presences["nom"]." ".$presences["prenom"]." ".$presences["matricule"]." ".$presences["referent"],$search)!== false);
}
if(isset($_POST["statut"])||isset($_POST["search"]))
$listeFiltre = array_filter($presences, 'filtrerPresences');
else{
    
    $listeFiltre = array_filter($presences, 'filtrerPresences');
}
if($_SESSION["user"]["role"]=="etudiant"){
    $tabTemp=[];
    foreach($listeFiltre as $filtre){
        if($_SESSION["user"]["mail"]==$filtre['mail'])
        $tabTemp[]=$filtre;
    }
    $listeFiltre=$tabTemp;
}


$totalPage=ceil(count($listeFiltre)/$eleByPage);

if($pageEtu<1 || $pageEtu>$totalPage)
$pageEtu= 0;
        $eleDeb = ($pageEtu-1)*$eleByPage;
        $etudiantsPage = array_slice($listeFiltre, $eleDeb, $eleByPage);

